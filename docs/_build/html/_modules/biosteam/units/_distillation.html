

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>biosteam.units._distillation &mdash; BioSTEAM 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> BioSTEAM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MixedStream objects and thermodynamic equilibrium.html">2. MixedStream objects and thermodynamic equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Creating a Unit.html">3. Creating a Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit operation examples.html">4. Unit operation examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Find unit operations and manage flowsheets.html">5. Find unit operations and manage flowsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Using -pipe- notation.html">6. Using -pipe- notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Techno-economic analysis of a biorefinery.html">7. Techno-economic analysis of a biorefinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Inheriting from Unit.html">8. Inheriting from Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit decorators.html">9. Unit decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Stoichiometric reactions.html">10. Stoichiometric reactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Advanced simulation.html">11. Advanced simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">BioSTEAM API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Species.html">Species</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Stream.html">Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MixedStream.html">MixedStream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit.html">Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PowerUtility.html">PowerUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../HeatUtility.html">HeatUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../System.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TEA.html">TEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Flowsheet.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../compounds.html">compounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../inspect.html">inspect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reaction.html">reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation.html">evaluation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BioSTEAM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>biosteam.units._distillation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for biosteam.units._distillation</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Aug 23 19:33:20 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">MixedStream</span><span class="p">,</span> <span class="n">Stream</span>
<span class="kn">from</span> <span class="nn">.._utils</span> <span class="k">import</span> <span class="n">approx2step</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">brentq</span>
<span class="kn">from</span> <span class="nn">._hx</span> <span class="k">import</span> <span class="n">HXutility</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">biosteam</span> <span class="k">as</span> <span class="nn">bst</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>

<span class="c1"># %% Equations</span>

<span class="c1"># Minimum thickness</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span> 
<span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ts_min_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># %% Dictionary of factors</span>

<span class="c1"># Tray Type</span>
<span class="n">F_TTdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Sieve&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;Valve&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span>
            <span class="s1">&#39;Bubble cap&#39;</span><span class="p">:</span> <span class="mf">1.87</span><span class="p">}</span>

<span class="c1"># Tray Materials (inner diameter, Di, in ft)</span>
<span class="n">F_TMdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Carbon steel&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;Stainless steel 304&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mf">1.189</span> <span class="o">+</span> <span class="mf">0.058</span><span class="o">*</span><span class="n">Di</span><span class="p">,</span>
            <span class="s1">&#39;Stainless steel 316&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mf">1.401</span> <span class="o">+</span> <span class="mf">0.073</span><span class="o">*</span><span class="n">Di</span><span class="p">,</span>
            <span class="s1">&#39;Carpenter 20CB-3&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mf">1.525</span> <span class="o">+</span> <span class="mf">0.079</span><span class="o">*</span><span class="n">Di</span><span class="p">,</span>
            <span class="s1">&#39;Monel&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mf">2.306</span> <span class="o">+</span> <span class="mf">0.112</span><span class="o">*</span><span class="n">Di</span><span class="p">}</span>

<span class="c1"># Column Material</span>
<span class="n">F_Mdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Carbon steel&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
           <span class="s1">&#39;Low-alloy steel&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
           <span class="s1">&#39;Stainless steel 304&#39;</span><span class="p">:</span> <span class="mf">1.7</span><span class="p">,</span>
           <span class="s1">&#39;Stainless steel 316&#39;</span><span class="p">:</span> <span class="mf">2.1</span><span class="p">,</span>
           <span class="s1">&#39;Carpenter 20CB-3&#39;</span><span class="p">:</span> <span class="mf">3.2</span><span class="p">,</span>
           <span class="s1">&#39;Nickel-200&#39;</span><span class="p">:</span> <span class="mf">5.4</span><span class="p">,</span>
           <span class="s1">&#39;Monel-400&#39;</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span>
           <span class="s1">&#39;Inconel-600&#39;</span><span class="p">:</span> <span class="mf">3.9</span><span class="p">,</span>
           <span class="s1">&#39;Incoloy-825&#39;</span><span class="p">:</span> <span class="mf">3.7</span><span class="p">,</span>
           <span class="s1">&#39;Titanium&#39;</span><span class="p">:</span> <span class="mf">7.7</span><span class="p">}</span>

<span class="c1"># Material density (lb∕in^3)</span>
<span class="n">rho_Mdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Carbon steel&#39;</span><span class="p">:</span> <span class="mf">0.284</span> <span class="p">,</span>
             <span class="s1">&#39;Low-alloy steel&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Stainless steel 304&#39;</span><span class="p">:</span> <span class="mf">0.289</span><span class="p">,</span>
             <span class="s1">&#39;Stainless steel 316&#39;</span><span class="p">:</span> <span class="mf">0.289</span><span class="p">,</span>
             <span class="s1">&#39;Carpenter 20CB-3&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Nickel-200&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Monel-400&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Inconel-600&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Incoloy-825&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
             <span class="s1">&#39;Titanium&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="c1"># %% Distillation</span>

<span class="c1"># Abstract doc string for columns</span>
<span class="n">column_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Create a {Column Type} column that assumes all light and heavy non keys separate to the top and bottoms product respectively. McCabe-Thiele analysis is used to find both the number of stages and the reflux ratio given a ratio of actual reflux to minimum reflux [1]. This assumption is good for both binary distillation of highly polar compounds and ternary distillation assuming complete separation of light non-keys and heavy non-keys with large differences in boiling points. Preliminary analysis showed that the theoretical number of stages using this method on Methanol/Glycerol/Water systems is off by less than +-1 stage. Other methods, such as the Fenske-Underwood-Gilliland method, are more suitable for hydrocarbons. The Murphree efficiency is based on the modified O&#39;Connell correlation [2]. The diameter is based on tray separation and flooding velocity [1]. Purchase costs are based on correlations by Mulet et al. [3, 4] as compiled by Warren et. al. [5].</span>

<span class="s2">    **Parameters**</span>

<span class="s2">        **LHK:** *tuple[str]* Light and heavy keys</span>

<span class="s2">        **P:** *[float]* Operating pressure (Pa)</span>

<span class="s2">        **y_top:** *[float]* Molar fraction of light key in the distillate</span>

<span class="s2">        **x_bot:** *[float]* Molar fraction of light key in the bottoms</span>

<span class="s2">        **k:** *[float]* Ratio of reflux to minimum reflux </span>

<span class="s2">    **ins**</span>
<span class="s2">        </span>
<span class="s2">        [:] All input streams</span>

<span class="s2">    **outs**</span>
<span class="s2">        </span>
<span class="s2">        [0] Distillate product</span>
<span class="s2">        </span>
<span class="s2">        [1] Bottoms product</span>

<span class="s2">    **References**</span>

<span class="s2">        [1] J.D. Seader, E.J. Henley, D.K. Roper. Separation Process Principles 3rd Edition. John Wiley &amp; Sons, Inc. (2011)</span>
<span class="s2">    </span>
<span class="s2">        [2] M. Duss, R. Taylor. Predict Distillation Tray Efficiency. AICHE (2018)</span>
<span class="s2">        </span>
<span class="s2">        [3] Mulet, A., A. B. Corripio, and L. B. Evans, “Estimate Costs of Pressure Vessels via Correlations,” Chem. Eng., 88(20), 145–150 (1981a).</span>

<span class="s2">        [4] Mulet, A., A.B. Corripio, and L.B.Evans, “Estimate Costs of Distillation and Absorption Towers via Correlations,” Chem. Eng., 88(26), 77–82 (1981b).</span>

<span class="s2">        [5] Seider, W. D., Lewin,  D. R., Seader, J. D., Widagdo, S., Gani, R., &amp; Ng, M. K. (2017). Product and Process Design Principles. Wiley. Cost Accounting and Capital Cost Estimation (Chapter 16)    </span>

<span class="s2">    **Examples**</span>
<span class="s2">    </span>
<span class="s2">        :doc:`{Column Type} Example`</span>
<span class="s2">    </span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Dist</span><span class="p">(</span><span class="n">Unit</span><span class="p">,</span> <span class="n">isabstract</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class for a column.&quot;&quot;&quot;</span>
    <span class="c1"># Bare module factor</span>
    <span class="n">BM</span> <span class="o">=</span> <span class="mf">4.3</span>
    
    <span class="c1"># Column material factor</span>
    <span class="n">_F_Mstr</span> <span class="o">=</span> <span class="s1">&#39;Carbon steel&#39;</span>
    <span class="n">_F_M</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># Tray type factor</span>
    <span class="n">_F_TTstr</span> <span class="o">=</span> <span class="s1">&#39;Sieve&#39;</span>
    <span class="n">_F_TT</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># Tray material factor function</span>
    <span class="n">_F_TMstr</span> <span class="o">=</span> <span class="s1">&#39;Carbon steel&#39;</span>
    <span class="n">_F_TM</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="k">lambda</span> <span class="n">Di</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># [float] Tray spacing (225-600 mm)</span>
    <span class="n">_TS</span> <span class="o">=</span> <span class="mi">450</span> 
    
    <span class="c1">#: [float] Enforced user defined stage efficiency.        </span>
    <span class="n">_stage_efficiency</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># [float] Ratio of actual velocity to maximum velocity allowable before flooding.</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="mf">0.8</span> 
    
    <span class="c1"># [float] Foaming factor (0 &lt; F_F &lt; 1)</span>
    <span class="n">_F_F</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># [float] Ratio of open area, A_h, to active area, A_a</span>
    <span class="n">_A_ha</span> <span class="o">=</span> <span class="mf">0.1</span>
    
    <span class="c1"># [float] Enforced ratio of downcomer area to net (total) area. If None, estimate ratio based on Oliver&#39;s estimation [1].</span>
    <span class="n">_A_dn</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># [dict] Bounds for results</span>
    <span class="n">_bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Diameter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">24.</span><span class="p">),</span>
               <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">27.</span><span class="p">,</span> <span class="mf">170.</span><span class="p">),</span>
               <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">9000.</span><span class="p">,</span> <span class="mf">2.5e6</span><span class="p">)}</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_P</span>
    <span class="nd">@P</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">liq</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LHK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span>
    <span class="nd">@LHK</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">LHK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LHK</span><span class="p">):</span>
        <span class="c1"># Set light non-key and heavy non-key indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span> <span class="o">=</span> <span class="n">LK</span><span class="p">,</span> <span class="n">HK</span> <span class="o">=</span> <span class="n">LHK</span>
        <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span> <span class="o">=</span> <span class="n">LK_index</span><span class="p">,</span> <span class="n">HK_index</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">LHK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_species</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span> <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">LHK</span><span class="p">]</span>
        
        <span class="n">species_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">)))</span>
        <span class="n">species_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">LK_index</span><span class="p">)</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">LK_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">HK_index</span> <span class="o">&gt;</span> <span class="n">LK_index</span><span class="p">:</span>
            <span class="n">HK_index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">species_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">HK_index</span><span class="p">)</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">HK_index</span><span class="p">)</span>
        <span class="n">Tbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">Tb</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">]</span>
        
        <span class="n">Tb_light</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">LK</span><span class="p">)</span><span class="o">.</span><span class="n">Tb</span>
        <span class="n">Tb_heavy</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">HK</span><span class="p">)</span><span class="o">.</span><span class="n">Tb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LNK_index</span> <span class="o">=</span> <span class="n">LNK_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HNK_index</span> <span class="o">=</span> <span class="n">HNK_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">Tb</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Tbs</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">species_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">Tb</span> <span class="o">&lt;</span> <span class="n">Tb_light</span><span class="p">:</span>
                <span class="n">LNK_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">Tb</span> <span class="o">&gt;</span> <span class="n">Tb_heavy</span><span class="p">:</span>
                <span class="n">HNK_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;intermediate volatile specie, &#39;</span><span class="si">{species_list[i]}</span><span class="s2">&#39;, between light and heavy key, [&#39;</span><span class="si">{LK}</span><span class="s2">&#39;, &#39;</span><span class="si">{HK}</span><span class="s2">&#39;].&quot;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_top</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_top</span>
    <span class="nd">@y_top</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_top</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_top</span> <span class="o">=</span> <span class="n">y_top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">y_top</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">y_top</span><span class="p">])</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_bot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_bot</span>
    <span class="nd">@x_bot</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_bot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_bot</span> <span class="o">=</span> <span class="n">x_bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">x_bot</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x_bot</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">P</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">LHK</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LHK</span> <span class="o">=</span> <span class="n">LHK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span> <span class="o">=</span> <span class="n">y_top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span> <span class="o">=</span> <span class="n">x_bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span>
    <span class="nd">@tray_spacing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tray spacing (225-600 mm).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span> <span class="o">=</span> <span class="n">TS</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enforced user defined stage efficiency.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stage_efficiency</span>
    <span class="nd">@stage_efficiency</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">stage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_efficiency</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stage_efficiency</span> <span class="o">=</span> <span class="n">stage_efficiency</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">velocity_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ratio of actual velocity to maximum velocity allowable before flooding.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>
    <span class="nd">@velocity_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">velocity_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">foaming_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Foaming factor (0 to 1).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span>
    <span class="nd">@foaming_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">foaming_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foaming_factor</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">foaming_factor</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">foaming_factor</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;foaming_factor must be between 0 and 1, (</span><span class="si">{foaming_factor}</span><span class="s2"> given).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span> <span class="o">=</span> <span class="n">foaming_factor</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open_area_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ratio of open area, A_h, to active area, A_a.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span>
    <span class="nd">@open_area_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">open_area_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span> <span class="o">=</span> <span class="n">A_ha</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">downcomer_area_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enforced ratio of downcomer area to net (total) area. If None, estimate ratio based on Oliver&#39;s estimation [1].&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
    <span class="nd">@downcomer_area_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">downcomer_area_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span> <span class="o">=</span> <span class="n">A_dn</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Sieve&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TTstr</span>
    <span class="nd">@tray_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tray_type</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_TT</span> <span class="o">=</span> <span class="n">F_TTdict</span><span class="p">[</span><span class="n">tray_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">F_TTdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">11</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;tray_type must be one of the following: </span><span class="si">{dummy}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_TTstr</span> <span class="o">=</span> <span class="n">tray_type</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_material</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Carbon steel&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TMstr</span>
    <span class="nd">@tray_material</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tray_material</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_TM</span> <span class="o">=</span> <span class="n">F_TMdict</span><span class="p">[</span><span class="n">tray_material</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">F_TMdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">11</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;tray_material must be one of the following: </span><span class="si">{dummy}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_TMstr</span> <span class="o">=</span> <span class="n">tray_material</span>        

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vessel_material</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Carbon steel&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_Mstr</span>
    <span class="nd">@vessel_material</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vessel_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vessel_material</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_M</span> <span class="o">=</span> <span class="n">F_Mdict</span><span class="p">[</span><span class="n">vessel_material</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">F_Mdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">11</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;vessel_material must be one of the following: </span><span class="si">{dummy}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_Mstr</span> <span class="o">=</span> <span class="n">vessel_material</span>  
    
    <span class="k">def</span> <span class="nf">_mass_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>

        <span class="c1"># Get all important flow rates (both light and heavy keys and non-keys)</span>
        <span class="n">LHK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span>
        <span class="n">LNK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LNK_index</span>
        <span class="n">HNK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HNK_index</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol_in</span>
        <span class="n">LHK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">HNK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">HNK_index</span><span class="p">]</span>
        <span class="n">LNK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">LNK_index</span><span class="p">]</span>

        <span class="c1"># Set light and heavy keys by lever rule</span>
        <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span> <span class="n">LHK_mol</span>
        <span class="n">LHK_molnet</span> <span class="o">=</span> <span class="n">light</span> <span class="o">+</span> <span class="n">heavy</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">light</span><span class="o">/</span><span class="n">LHK_molnet</span>
        <span class="n">split_frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">zf</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_top</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span><span class="p">)</span>
        <span class="n">top_net</span> <span class="o">=</span> <span class="n">LHK_molnet</span><span class="o">*</span><span class="n">split_frac</span>

        <span class="c1"># Set output streams</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_net</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>
        <span class="n">liq</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">LHK_mol</span> <span class="o">-</span> <span class="n">vap</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LNK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">LNK_mol</span>
        <span class="n">liq</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">HNK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">HNK_mol</span>
    
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mass_balance</span><span class="p">()</span>
        
        <span class="c1"># Unpack arguments</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">_species</span>
        <span class="n">cmps</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">_compounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_top_index</span> <span class="o">=</span> <span class="n">top_index</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">_equilibrium_indices</span><span class="p">(</span><span class="n">vap</span><span class="o">.</span><span class="n">_mol</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bot_index</span> <span class="o">=</span> <span class="n">bot_index</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">_equilibrium_indices</span><span class="p">(</span><span class="n">liq</span><span class="o">.</span><span class="n">_mol</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vle_top</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vle_bot</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bot_index</span><span class="p">]</span>

        <span class="c1"># Get top and bottom compositions</span>
        <span class="n">vap_mol</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">top_index</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">vap_mol</span><span class="o">/</span><span class="n">vap_mol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">liq_mol</span> <span class="o">=</span> <span class="n">liq</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">bot_index</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="o">/</span><span class="n">liq_mol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Run top equilibrium to find temperature and composition of condensate</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">_gamma</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vle_top</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate_molfrac</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">_dew_point</span><span class="o">.</span><span class="n">solve_Tx</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">vap</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>

        <span class="c1"># Run bottoms equilibrium to find temperature</span>
        <span class="n">liq</span><span class="o">.</span><span class="n">_gamma</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vle_bot</span>
        <span class="n">liq</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boilup_molfrac</span> <span class="o">=</span> <span class="n">liq</span><span class="o">.</span><span class="n">_bubble_point</span><span class="o">.</span><span class="n">solve_Ty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">liq</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_equilibrium_staircase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operating_line</span><span class="p">,</span> <span class="n">x_stairs</span><span class="p">,</span>
                               <span class="n">y_stairs</span><span class="p">,</span> <span class="n">T_stairs</span><span class="p">,</span> <span class="n">x_limit</span><span class="p">,</span> <span class="n">bubble_T</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the specifications at every stage of the of the operating line before the maximum liquid molar fraction. Append the light key liquid molar fraction, light key vapor molar fraction, and stage temperatures to x_stairs, y_stairs and T_stairs respectively.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            operating_line: [function] Should return the liquid molar fraction of the light key given its vapor molar fraction.</span>
<span class="sd">            </span>
<span class="sd">            x_stairs: [list] Liquid molar compositions at each stage. Last element should be the starting point for the next stage</span>
<span class="sd">            </span>
<span class="sd">            y_stairs: [list] Vapor molar compositions at each stage. Last element should be the starting point for the next stage</span>
<span class="sd">            </span>
<span class="sd">            T_stairs: [list] Temperature at each stage.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">y_stairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">x_stairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="n">x_limit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;cannot meet specifications! stages &gt; 100&#39;</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Go Up</span>
            <span class="n">T</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bubble_T</span><span class="p">(</span><span class="n">array</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">xi</span><span class="p">)),</span> <span class="n">P</span><span class="p">)</span>
            <span class="n">yi</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
            <span class="n">T_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
            <span class="c1"># Go Right</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">operating_line</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">x_limit</span>
            <span class="n">x_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_plot_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot stages, graphical aid line, and equilibrium curve. The plot does not include operating lines nor a legend.&quot;&quot;&quot;</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;x_stages&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">x_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span>
        <span class="n">y_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span>
        <span class="n">light</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LHK</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        
        <span class="c1"># Equilibrium data</span>
        <span class="n">x_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">y_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">vap</span><span class="o">.</span><span class="n">_gamma</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_species</span>
        <span class="n">bubble_T</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">_bubble_point</span><span class="o">.</span><span class="n">solve_Ty</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x_eq</span><span class="p">:</span>
            <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bubble_T</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="n">xi</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">xi</span><span class="p">]),</span> <span class="n">P</span><span class="p">)</span>
            <span class="n">y_eq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="c1"># Set-up graph</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (&#39;</span> <span class="o">+</span> <span class="n">light</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y (&#39;</span> <span class="o">+</span> <span class="n">light</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Plot stages</span>
        <span class="n">x_stairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_stages</span><span class="p">:</span>
            <span class="n">x_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="n">y_stairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y_stages</span><span class="p">:</span>
            <span class="n">y_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x_stairs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x_stairs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_stairs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_stairs</span><span class="p">,</span> <span class="n">y_stairs</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
        
        <span class="c1"># Graphical aid line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Vapor equilibrium graph</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">y_eq</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cost_trays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N_T</span><span class="p">,</span> <span class="n">Di</span><span class="p">:</span><span class="s1">&#39;ft&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return total cost of all trays at a CE of 500.&quot;&quot;&quot;</span>
        <span class="c1"># Note: Can only use this function after running design method.</span>
        <span class="n">C_BT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_TrayBaseCost</span><span class="p">(</span><span class="n">Di</span><span class="p">)</span>
        <span class="n">F_NT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NTrayFactor</span><span class="p">(</span><span class="n">N_T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">N_T</span><span class="o">*</span><span class="n">F_NT</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_F_TT</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_F_TM</span><span class="p">(</span><span class="n">Di</span><span class="p">)</span><span class="o">*</span><span class="n">C_BT</span>

    <span class="k">def</span> <span class="nf">_cost_tower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Di</span><span class="p">:</span><span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span><span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="n">W</span><span class="p">:</span><span class="s1">&#39;lb&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return cost of tower at a CE of 500.&quot;&quot;&quot;</span>
        <span class="n">C_V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_EmptyTowerCost</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">C_PL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_PlaformLadderCost</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_F_M</span><span class="o">*</span><span class="n">C_V</span> <span class="o">+</span> <span class="n">C_PL</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_EmptyTowerCost</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return C_V the cost (USD) of an empty tower vessel assuming a CE of 500.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            W: Weight (lb)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">7.2756</span> <span class="o">+</span> <span class="mf">0.18255</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.02297</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_PlaformLadderCost</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return C_PL, the cost (USD) of platforms and ladders assuming a CE of 500.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            Di: Inner diameter (ft)</span>
<span class="sd">            L: Legnth (ft)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">300.9</span><span class="o">*</span><span class="n">Di</span><span class="o">**</span><span class="mf">0.63316</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mf">0.80161</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_Weight</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return W, the weight (lb) of the tower assuming 2:1 elliptical head.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            Di: Diameter (ft)</span>
<span class="sd">            L: Legnth (ft)</span>
<span class="sd">            tv: Shell thickness (in)</span>
<span class="sd">            rho_M: Density of material (lb/in^3)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="n">Di</span><span class="o">*</span><span class="mi">12</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="mi">12</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Di</span><span class="o">+</span><span class="n">tv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mf">0.8</span><span class="o">*</span><span class="n">Di</span><span class="p">)</span><span class="o">*</span><span class="n">tv</span><span class="o">*</span><span class="n">rho_M</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_WallThickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="mf">29.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return tv, the wall thinkness (in) designed to withstand the internal pressure and the wind/earthquake load at the bottom.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            Po: Operating internal pressure (psi)</span>
<span class="sd">            Di: Internal diameter (ft)</span>
<span class="sd">            L: Height (ft)</span>
<span class="sd">            S: Maximum stress (psi)</span>
<span class="sd">            E: Fractional weld efficiency</span>
<span class="sd">            M: Elasticity (psi)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Incorporate temperature for choosing S and M</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="n">Di</span><span class="o">*</span><span class="mi">12</span> <span class="c1"># ft to in</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="mi">12</span>
        
        <span class="n">E_check</span> <span class="o">=</span> <span class="n">E</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">E_check</span><span class="p">:</span>
            <span class="c1"># Assume carbon steel with thickness more than 1.25 in</span>
            <span class="n">E</span> <span class="o">=</span> <span class="mf">1.0</span> 
        
        <span class="c1"># Get design pressure, which should be higher than operating pressure.</span>
        <span class="n">Po_gauge</span> <span class="o">=</span> <span class="n">Po</span> <span class="o">-</span> <span class="mf">14.69</span>
        <span class="k">if</span> <span class="n">Po_gauge</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># TODO: Double check vacuum calculation</span>
            <span class="n">Pd</span> <span class="o">=</span> <span class="o">-</span><span class="n">Po_gauge</span>
            <span class="n">tE</span> <span class="o">=</span> <span class="mf">1.3</span><span class="o">*</span><span class="n">Di</span><span class="o">*</span><span class="p">(</span><span class="n">Pd</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">M</span><span class="o">/</span><span class="n">Di</span><span class="p">)</span><span class="o">**</span><span class="mf">0.4</span>
            <span class="n">tEC</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="mf">0.18</span><span class="o">*</span><span class="n">Di</span> <span class="o">-</span> <span class="mf">2.2</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">5</span> <span class="o">-</span> <span class="mf">0.19</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">tE</span> <span class="o">+</span> <span class="n">tEC</span>
            <span class="k">return</span> <span class="n">tv</span>
        <span class="k">elif</span> <span class="n">Po_gauge</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">Pd</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="n">Po_gauge</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">Pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.60608</span> <span class="o">+</span> <span class="mf">0.91615</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Po</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.0015655</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Po</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Pd</span> <span class="o">=</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">Po_gauge</span>
        
        <span class="c1"># Calculate thinkess according to ASME pressure-vessel code.</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">Pd</span><span class="o">*</span><span class="n">Di</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">E</span><span class="o">-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">Pd</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">E_check</span><span class="p">:</span>
            <span class="c1"># Weld efficiency of 0.85 for low thickness carbon steel</span>
            <span class="k">if</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="mf">1.25</span><span class="p">:</span>
                <span class="n">E</span> <span class="o">=</span> <span class="mf">0.85</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">Pd</span><span class="o">*</span><span class="n">Di</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">E</span><span class="o">-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">Pd</span><span class="p">)</span>
        
        <span class="c1"># Add corrosion allowence</span>
        <span class="n">ts</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>
        
        <span class="c1"># Minimum thickness for vessel rigidity may be larger</span>
        <span class="n">Di_ft</span> <span class="o">=</span> <span class="n">Di</span><span class="o">/</span><span class="mi">12</span>
        <span class="n">ts_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">ts_min_p</span><span class="p">,</span> <span class="n">Di</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span> <span class="k">if</span> <span class="n">Di_ft</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="mf">0.25</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">ts_min</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">ts_min</span>
        
        <span class="c1"># Calculate thickness to withstand wind/earthquake load</span>
        <span class="n">Do</span> <span class="o">=</span> <span class="n">Di</span> <span class="o">+</span> <span class="n">ts</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="mf">0.22</span><span class="o">*</span><span class="p">(</span><span class="n">Do</span> <span class="o">+</span> <span class="mi">18</span><span class="p">)</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="n">Do</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
        
        <span class="c1"># Vessels are fabricated from metal plates with small increments</span>
        <span class="k">if</span> <span class="n">tv</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">approx2step</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tv</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">approx2step</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tv</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">approx2step</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tv</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_TrayBaseCost</span><span class="p">(</span><span class="n">Di</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return C_BT, the base cost of a tray (USD) at a CE of 500.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            Di: Inner diameter (ft)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">412.6985</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.1482</span><span class="o">*</span><span class="n">Di</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_NTrayFactor</span><span class="p">(</span><span class="n">N_T</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return F_NT, the cost factor for number of trays.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            N_T: Number of trays</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">N_T</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">F_NT</span> <span class="o">=</span> <span class="mf">2.25</span><span class="o">/</span><span class="mf">1.0414</span><span class="o">**</span><span class="n">N_T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F_NT</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">F_NT</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_MurphreeEfficiency</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return E_mv, the sectional murphree efficiency.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">            </span>
<span class="sd">            mu: Viscosity (mPa*s)</span>
<span class="sd">            </span>
<span class="sd">            alpha: Relative volatility</span>
<span class="sd">            </span>
<span class="sd">            L: Liquid flow rate by mol</span>
<span class="sd">            </span>
<span class="sd">            V: Vapor flow rate by mol</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">V</span><span class="o">/</span><span class="n">L</span> <span class="c1"># Stripping factor</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mf">0.503</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.226</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">S</span> <span class="k">if</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="o">/</span><span class="n">S</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.08</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_FlowParameter</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return F_LV, the flow parameter.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            L: Liquid flow rate by mass</span>
<span class="sd">            V: Vapor flow rate by mass</span>
<span class="sd">            rho_V: Vapor density</span>
<span class="sd">            rho_L: Liquid density</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">L</span><span class="o">/</span><span class="n">V</span><span class="o">*</span><span class="p">(</span><span class="n">rho_V</span><span class="o">/</span><span class="n">rho_L</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_MaxCapacityParameter</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">F_LV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return C_sbf, the maximum capacity parameter before flooding (m/s).</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            TS: Tray spacing (mm)</span>
<span class="sd">            F_LV: Flow parameter</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.0105</span> <span class="o">+</span> <span class="mf">8.127e-4</span><span class="o">*</span><span class="n">TS</span><span class="o">**</span><span class="mf">0.755</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.463</span><span class="o">*</span><span class="n">F_LV</span><span class="o">**</span><span class="mf">0.842</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_MaxVaporVelocity</span><span class="p">(</span><span class="n">C_sbf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span>
                               <span class="n">rho_L</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">F_F</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return U_f, the maximum allowable vapor velocity through the net area of flow before flooding (m/s).</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            C_sbf: Maximum Capacity Parameter (m/s)</span>
<span class="sd">            sigma: Liquid surface tension (dyn/cm)</span>
<span class="sd">            rho_L: Liquid density</span>
<span class="sd">            rho_V: Vapor density</span>
<span class="sd">            F_F: Foaming factor</span>
<span class="sd">            A_ha: Ratio of open area, A_h, to active area, A_a</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">F_ST</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">**</span><span class="mf">0.2</span> <span class="c1"># Surface tension factor</span>
        
        <span class="c1"># Working area factor</span>
        <span class="k">if</span> <span class="n">A_ha</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="n">A_ha</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">F_HA</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">A_ha</span> <span class="o">&gt;=</span> <span class="mf">0.06</span><span class="p">:</span>
            <span class="n">F_HA</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">A_ha</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;ratio of open to active area, &#39;A&#39;, must be between 0.06 and 1 (</span><span class="si">{A_ha}</span><span class="s2"> given)&quot;</span><span class="p">)</span> 
        
        <span class="k">return</span> <span class="n">C_sbf</span> <span class="o">*</span> <span class="n">F_HA</span> <span class="o">*</span> <span class="n">F_ST</span> <span class="o">*</span> <span class="p">((</span><span class="n">rho_L</span><span class="o">-</span><span class="n">rho_V</span><span class="p">)</span><span class="o">/</span><span class="n">rho_V</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_DowncomerAreaRatio</span><span class="p">(</span><span class="n">F_LV</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;A_dn&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return A_dn, the ratio of downcomer area to net (total) area.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            F_LV: Flow parameter</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">F_LV</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">A_dn</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">elif</span> <span class="n">F_LV</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">A_dn</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="p">(</span><span class="n">F_LV</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="mi">9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A_dn</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="k">return</span> <span class="n">A_dn</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_Diameter</span><span class="p">(</span><span class="n">V_vol</span><span class="p">,</span> <span class="n">U_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return D_T, the column diameter (ft).</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            V_vol: Vapor volumetric flow rate (m^3/s)</span>
<span class="sd">            U_f: Maximum vapor velocity before flooding(m/s)</span>
<span class="sd">            f: Ratio of actual velocity to U_f</span>
<span class="sd">            A_dn: ratio of downcomer area to net (total) area</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">V_vol</span><span class="o">/</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">U_f</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">A_dn</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">Di</span> <span class="o">&lt;</span> <span class="mf">0.914</span><span class="p">:</span>
            <span class="c1"># Make sure diameter is not too small</span>
            <span class="n">Di</span> <span class="o">=</span> <span class="mf">0.914</span>
        <span class="n">Di</span> <span class="o">*=</span> <span class="mf">3.28</span>
        <span class="k">return</span> <span class="n">Di</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_Height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Nstages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return H, the height of the column (ft).</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            TS: Tray spacing (mm)</span>
<span class="sd">            Nstages: Number of stages </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 3 m bottoms surge capacity, 1.25 m above top tray to remove entrained liquid</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">TS</span><span class="o">*</span><span class="n">Nstages</span><span class="o">/</span><span class="mi">1000</span>
        <span class="k">if</span> <span class="n">top</span><span class="p">:</span>
            <span class="n">H</span> <span class="o">+=</span> <span class="mf">1.2672</span>
        <span class="k">if</span> <span class="n">bot</span><span class="p">:</span>
            <span class="n">H</span> <span class="o">+=</span> <span class="mi">3</span>
        <span class="n">H</span> <span class="o">*=</span> <span class="mf">3.28</span>
        <span class="k">return</span> <span class="n">H</span> 

    <span class="k">def</span> <span class="nf">_calc_condenser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distillate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate</span> <span class="c1"># Abstract attribute</span>
        <span class="n">condenser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condenser</span>
        <span class="n">s_in</span> <span class="o">=</span> <span class="n">condenser</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_in</span><span class="o">.</span><span class="n">_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span><span class="o">+</span><span class="n">condensate</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">s_in</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">T</span>
        <span class="n">s_in</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">P</span>
        <span class="n">ms1</span> <span class="o">=</span> <span class="n">condenser</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">liquid_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">P</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">vapor_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">condenser</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">condenser</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_calc_boiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bottoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">boil_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boil_up</span> <span class="c1"># Abstract attribute</span>
        <span class="n">boiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boiler</span>
        <span class="n">s_in</span> <span class="o">=</span> <span class="n">boiler</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_in</span><span class="o">.</span><span class="n">copylike</span><span class="p">(</span><span class="n">bottoms</span><span class="p">)</span>
        <span class="n">s_in</span><span class="o">.</span><span class="n">_mol</span> <span class="o">+=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">ms1</span> <span class="o">=</span> <span class="n">boiler</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">P</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">vapor_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">ms1</span><span class="o">.</span><span class="n">liquid_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_condenser&#39;</span><span class="p">):</span>
            <span class="n">boiler</span><span class="o">.</span><span class="n">_design</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_H_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_H_in</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condenser</span><span class="o">.</span><span class="n">_duty</span><span class="p">)</span>
            <span class="n">boiler</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boiler</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
            <span class="n">boiler</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="n">Cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cost</span>
        <span class="n">F_CE</span> <span class="o">=</span> <span class="n">bst</span><span class="o">.</span><span class="n">CE</span><span class="o">/</span><span class="mi">500</span>
        
        <span class="c1"># Cost trays assuming a partial condenser</span>
        <span class="n">N_T</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Actual stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Diameter&#39;</span><span class="p">]</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_trays</span><span class="p">(</span><span class="n">N_T</span><span class="p">,</span> <span class="n">Di</span><span class="p">)</span>
        
        <span class="c1"># Cost vessel assuming T &lt; 800 F</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_tower</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost_components</span><span class="p">()</span>
        

<div class="viewcode-block" id="Distillation"><a class="viewcode-back" href="../../../Distillation.html#biosteam.units.Distillation">[docs]</a><span class="k">class</span> <span class="nc">Distillation</span><span class="p">(</span><span class="n">Dist</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Distillation&#39;</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">column_doc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{Column Type}&#39;</span><span class="p">,</span> <span class="s1">&#39;Distillation&#39;</span><span class="p">)</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_graphics</span> <span class="o">=</span> <span class="n">Dist</span><span class="o">.</span><span class="n">_graphics</span>
    <span class="n">_is_divided</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#: [bool] True if the stripper and rectifier are two separate columns.</span>
    <span class="n">_units_not_divided</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Rectifier height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Rectifier wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Rectifier weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Stripper height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Stripper diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Stripper wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Stripper weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">}</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="n">_units_not_divided</span>
    <span class="n">_units_divided</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Rectifier height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Rectifier wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Rectifier weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Stripper height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Stripper diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Stripper wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Stripper weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">P</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">LHK</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">LHK</span><span class="o">=</span><span class="n">LHK</span><span class="p">,</span>
                         <span class="n">y_top</span><span class="o">=</span><span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="o">=</span><span class="n">x_bot</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_condenser</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">ins</span><span class="o">=</span><span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">),</span>
                                    <span class="n">outs</span><span class="o">=</span><span class="n">MixedStream</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boiler</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">ins</span><span class="o">=</span><span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
                                 <span class="n">outs</span><span class="o">=</span><span class="n">MixedStream</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condenser</span><span class="o">.</span><span class="n">_heat_utilities</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boiler</span><span class="o">.</span><span class="n">_heat_utilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_condensate</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boil_up</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vapor_stream</span> <span class="o">=</span>  <span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_divided</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[bool] True if the stripper and rectifier are two separate columns.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_divided</span>
    
    <span class="nd">@is_divided</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">is_divided</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_divided</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_divided</span> <span class="o">=</span> <span class="n">is_divided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_divided</span> <span class="k">if</span> <span class="n">is_divided</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_not_divided</span>
    
    <span class="k">def</span> <span class="nf">_calc_Nstages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple with the actual number of stages for the rectifier and the stripper.&quot;&quot;&quot;</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="n">x_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span>
        <span class="n">y_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">N_stages</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span>
        <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span>
        <span class="n">liq_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_liqmol</span>
        <span class="n">vap_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_vapmol</span>
        
        <span class="n">stage_efficiency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_efficiency</span>
        <span class="k">if</span> <span class="n">stage_efficiency</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">N_stages</span><span class="o">/</span><span class="n">stage_efficiency</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1"># Calculate Murphree Efficiency for rectifying section</span>
            <span class="n">vap_molnet</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">molnet</span>
            <span class="n">condensate_molfrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate_molfrac</span>
            <span class="n">vle_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vle_top</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_L_Rmol</span> <span class="o">=</span> <span class="n">L_Rmol</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">vap_molnet</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_V_Rmol</span> <span class="o">=</span> <span class="n">V_Rmol</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">vap_molnet</span>
            <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate</span>
            <span class="n">condensate</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="n">condensate_molfrac</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vle_top</span><span class="p">])</span>
            <span class="n">condensate</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">T</span>
            <span class="n">condensate</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">P</span>
            <span class="n">condensate</span><span class="o">.</span><span class="n">_mol</span><span class="p">[:]</span> <span class="o">*=</span> <span class="n">L_Rmol</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">condensate</span><span class="o">.</span><span class="n">mu</span> <span class="c1"># mPa*s</span>
            <span class="n">K_light</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">K_heavy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">K_light</span><span class="o">/</span><span class="n">K_heavy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_E_rectifier</span> <span class="o">=</span> <span class="n">E_rectifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MurphreeEfficiency</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">L_Rmol</span><span class="p">,</span> <span class="n">V_Rmol</span><span class="p">)</span>
            
            <span class="c1"># Calculate Murphree Efficiency for stripping section</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">liq</span><span class="o">.</span><span class="n">mu</span> <span class="c1"># mPa*s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_V_Smol</span> <span class="o">=</span> <span class="n">V_Smol</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">vap_molnet</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vap_mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_L_Smol</span> <span class="o">=</span> <span class="n">L_Smol</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">vap_molnet</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">liq_mol</span><span class="p">)</span> 
            <span class="n">K_light</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">K_heavy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">K_light</span><span class="o">/</span><span class="n">K_heavy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_E_stripper</span> <span class="o">=</span> <span class="n">E_stripper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MurphreeEfficiency</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">L_Smol</span><span class="p">,</span> <span class="n">V_Smol</span><span class="p">)</span>
            
            <span class="c1"># Calculate actual number of stages</span>
            <span class="n">mid_stage</span> <span class="o">=</span> <span class="n">feed_stage</span> <span class="o">-</span> <span class="mf">0.5</span>
            <span class="n">N_rectifier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">mid_stage</span><span class="o">/</span><span class="n">E_rectifier</span><span class="p">)</span>
            <span class="n">N_stripper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="p">(</span><span class="n">N_stages</span><span class="o">-</span><span class="n">mid_stage</span><span class="p">)</span><span class="o">/</span><span class="n">E_stripper</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">N_rectifier</span><span class="p">,</span> <span class="n">N_stripper</span>

    <span class="k">def</span> <span class="nf">_McCabeThiele</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">LHK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span>

        <span class="c1"># Feed light key mol fraction</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">_species</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">_N</span>
        <span class="n">liq_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">vap_mol</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                <span class="n">vap_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                <span class="n">liq_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">MixedStream</span><span class="p">):</span>
                <span class="n">liq_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">liquid_mol</span>
                <span class="n">vap_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">vapor_mol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;invalid phase encountered in {repr(s)}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_liqmol</span> <span class="o">=</span> <span class="n">liq_mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_vapmol</span> <span class="o">=</span> <span class="n">vap_mol</span>
        <span class="n">LHK_mol</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vap_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">LHK_molnet</span> <span class="o">=</span> <span class="n">LHK_mol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">LHK_mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">LHK_molnet</span>
        
        <span class="c1"># Get feed quality</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">LHK_molnet</span>
        
        <span class="c1"># Main arguments</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">y_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span>
        <span class="n">x_bot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span>
        
        <span class="c1"># Cache</span>
        <span class="n">old_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">P</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">zf</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">old_args</span> <span class="o">-</span> <span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">],</span> <span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># Get R_min and the q_line </span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q_line</span> <span class="o">=</span> <span class="n">q_line</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">q</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zf</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">bottoms</span><span class="o">.</span><span class="n">_gamma</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_species</span>
        <span class="n">bubble_T</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">_bubble_point</span><span class="o">.</span><span class="n">solve_Ty</span>
        <span class="n">Rmin_intersection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">bubble_T</span><span class="p">(</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)),</span> <span class="n">P</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_Rmin</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">Rmin_intersection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y_Rmin</span> <span class="o">=</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x_Rmin</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_Rmin</span><span class="o">-</span><span class="n">y_top</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_Rmin</span><span class="o">-</span><span class="n">y_top</span><span class="p">)</span>
        <span class="n">Rmin</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Rmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">k</span>

        <span class="c1"># Rectifying section: Inntersects q_line with slope given by R/(R+1)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">R</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">y_top</span><span class="o">-</span><span class="n">m1</span><span class="o">*</span><span class="n">y_top</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">b1</span><span class="p">)</span><span class="o">/</span><span class="n">m1</span> <span class="c1"># -&gt; x</span>
        
        <span class="c1"># y_m is the solution to lambda y: y - q_line(rs(y))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span> <span class="o">=</span> <span class="n">y_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">m1</span><span class="o">*</span><span class="n">zf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span> <span class="o">=</span> <span class="n">x_m</span> <span class="o">=</span> <span class="n">rs</span><span class="p">(</span><span class="n">y_m</span><span class="p">)</span>
        
        <span class="c1"># Stripping section: Intersects Rectifying section and q_line and beggins at bottoms liquid composition</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_bot</span><span class="o">-</span><span class="n">y_m</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_bot</span><span class="o">-</span><span class="n">x_m</span><span class="p">)</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">y_m</span><span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">x_m</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">b2</span><span class="p">)</span><span class="o">/</span><span class="n">m2</span> <span class="c1"># -&gt; x        </span>
        
        <span class="c1"># Data for staircase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span> <span class="o">=</span> <span class="n">x_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span> <span class="o">=</span> <span class="n">y_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_T_stages</span> <span class="o">=</span> <span class="n">T_stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_equilibrium_staircase</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">x_stages</span><span class="p">,</span> <span class="n">y_stages</span><span class="p">,</span> <span class="n">T_stages</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">bubble_T</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">rs</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
        <span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi</span> <span class="k">if</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.99999</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_equilibrium_staircase</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">x_stages</span><span class="p">,</span> <span class="n">y_stages</span><span class="p">,</span> <span class="n">T_stages</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">bubble_T</span><span class="p">)</span>
        
        <span class="c1"># Find feed stage</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_stages</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">y_stages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_m</span> <span class="ow">and</span> <span class="n">y_stages</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y_m</span><span class="p">:</span>
                <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_stages</span><span class="p">)</span>
        
        <span class="c1"># Results</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feed_stage</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stages</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rmin</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
        

    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele</span><span class="p">()</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">Rstages</span><span class="p">,</span> <span class="n">Sstages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Nstages</span><span class="p">()</span>
        <span class="n">calc_Height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Height</span>
        <span class="n">is_divided</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_divided</span>
        <span class="n">TS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span>
        
        <span class="c1">### Get diameter of rectifying section based on top plate ###</span>
        
        <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate</span>
        <span class="n">rho_L</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">sigma</span> <span class="c1"># dyn/cm</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">massnet</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">R</span>
        <span class="n">vapor_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vapor_stream</span>
        <span class="n">vapor_stream</span><span class="o">.</span><span class="n">copylike</span><span class="p">(</span><span class="n">distillate</span><span class="p">)</span>
        <span class="n">vapor_stream</span><span class="o">.</span><span class="n">_mol</span> <span class="o">*=</span> <span class="n">R</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">V_vol</span> <span class="o">=</span> <span class="mf">0.0002778</span> <span class="o">*</span> <span class="n">vapor_stream</span><span class="o">.</span><span class="n">volnet</span> <span class="c1"># m^3/s</span>
        <span class="n">rho_V</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">F_LV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_FlowParameter</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">)</span>
        <span class="n">C_sbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MaxCapacityParameter</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">F_LV</span><span class="p">)</span>
        <span class="n">F_F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span>
        <span class="n">A_ha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span>
        <span class="n">U_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MaxVaporVelocity</span><span class="p">(</span><span class="n">C_sbf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">F_F</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">)</span>
        <span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
        <span class="k">if</span> <span class="n">A_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span> <span class="o">=</span> <span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_DowncomerAreaRatio</span><span class="p">(</span><span class="n">F_LV</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>
        <span class="n">R_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Diameter</span><span class="p">(</span><span class="n">V_vol</span><span class="p">,</span> <span class="n">U_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">)</span>
        
        <span class="c1">### Get diameter of stripping section based on feed plate ###</span>
        
        <span class="n">V_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_V_Smol</span>
        <span class="n">rho_L</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">boil_up_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boilup_molfrac</span> <span class="o">*</span> <span class="n">V_mol</span>
        <span class="n">boil_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boil_up</span>
        <span class="n">boil_up</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">T</span><span class="p">;</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">P</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">_species</span><span class="o">.</span><span class="n">_compounds</span><span class="o">.</span><span class="n">index</span>
        <span class="n">index_</span> <span class="o">=</span> <span class="p">[</span><span class="n">lookup</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vle_bot</span><span class="p">]</span>
        <span class="n">boil_up</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index_</span><span class="p">]</span> <span class="o">=</span> <span class="n">boil_up_flow</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">massnet</span>
        <span class="n">V_vol</span> <span class="o">=</span> <span class="mf">0.0002778</span> <span class="o">*</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">volnet</span> <span class="c1"># m^3/s</span>
        <span class="n">rho_V</span> <span class="o">=</span> <span class="n">boil_up</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">massnet</span> <span class="c1"># To get liquid going down</span>
        <span class="n">F_LV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_FlowParameter</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">)</span>
        <span class="n">C_sbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MaxCapacityParameter</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">F_LV</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">sigma</span> <span class="c1"># dyn/cm</span>
        <span class="n">U_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_MaxVaporVelocity</span><span class="p">(</span><span class="n">C_sbf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">F_F</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">)</span>
        <span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
        <span class="k">if</span> <span class="n">A_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_DowncomerAreaRatio</span><span class="p">(</span><span class="n">F_LV</span><span class="p">)</span>
        <span class="n">S_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Diameter</span><span class="p">(</span><span class="n">V_vol</span><span class="p">,</span> <span class="n">U_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">)</span>
        <span class="n">Po</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">*</span><span class="mf">0.000145078</span> <span class="c1"># to psi</span>
        <span class="n">rho_M</span> <span class="o">=</span> <span class="n">rho_Mdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_F_Mstr</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">is_divided</span><span class="p">:</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper stages&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">Sstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_R</span> <span class="o">=</span> <span class="n">calc_Height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Rstages</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_S</span> <span class="o">=</span> <span class="n">calc_Height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Sstages</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R_diameter</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_diameter</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_WallThickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">R_diameter</span><span class="p">,</span> <span class="n">H_R</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_WallThickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">S_diameter</span><span class="p">,</span> <span class="n">H_S</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Weight</span><span class="p">(</span><span class="n">R_diameter</span><span class="p">,</span> <span class="n">H_R</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Weight</span><span class="p">(</span><span class="n">S_diameter</span><span class="p">,</span> <span class="n">H_S</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Actual stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rstages</span> <span class="o">+</span> <span class="n">Sstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span> <span class="o">=</span> <span class="n">calc_Height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Rstages</span><span class="o">+</span><span class="n">Sstages</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Di</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">R_diameter</span><span class="p">,</span> <span class="n">S_diameter</span><span class="p">))</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_WallThickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_Weight</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_divided</span><span class="p">:</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="n">Cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cost</span>
        <span class="n">F_CE</span> <span class="o">=</span> <span class="n">bst</span><span class="o">.</span><span class="n">CE</span><span class="o">/</span><span class="mi">500</span>
        
        <span class="c1"># Number of trays assuming a partial condenser</span>
        <span class="n">N_RT</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Di_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">]</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Rectifier trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_trays</span><span class="p">(</span><span class="n">N_RT</span><span class="p">,</span> <span class="n">Di_R</span><span class="p">)</span>
        <span class="n">N_ST</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Di_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper diameter&#39;</span><span class="p">]</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Stripper trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_trays</span><span class="p">(</span><span class="n">N_ST</span><span class="p">,</span> <span class="n">Di_S</span><span class="p">)</span>
        
        <span class="c1"># Cost vessel assuming T &lt; 800 F</span>
        <span class="n">W_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
        <span class="n">H_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Rectifier tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_tower</span><span class="p">(</span><span class="n">Di_R</span><span class="p">,</span> <span class="n">H_R</span><span class="p">,</span> <span class="n">W_R</span><span class="p">)</span>
        <span class="n">W_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
        <span class="n">H_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Stripper tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_CE</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_cost_tower</span><span class="p">(</span><span class="n">Di_S</span><span class="p">,</span> <span class="n">H_S</span><span class="p">,</span> <span class="n">W_S</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost_components</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_cost_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="c1"># Cost condenser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_condenser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Cost</span><span class="p">[</span><span class="s1">&#39;Condenser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condenser</span><span class="o">.</span><span class="n">_Cost</span><span class="p">[</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span>
        
        <span class="c1"># Cost boiler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_boiler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Cost</span><span class="p">[</span><span class="s1">&#39;Boiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boiler</span><span class="o">.</span><span class="n">_Cost</span><span class="p">[</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span>
        
    
<div class="viewcode-block" id="Distillation.plot_stages"><a class="viewcode-back" href="../../../Distillation.html#biosteam.units.Distillation.plot_stages">[docs]</a>    <span class="k">def</span> <span class="nf">plot_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the McCabe Thiele Diagram.&quot;&quot;&quot;</span>
        <span class="c1"># Plot stages, graphical aid and equilibrium curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_stages</span><span class="p">()</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Design</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_x_stages&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">q_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_line</span>
        <span class="n">y_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span>
        <span class="n">x_bot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span>
        <span class="n">Rmin</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span>
        
        <span class="c1"># q_line</span>
        <span class="k">def</span> <span class="nf">intersect2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_m2</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">intersect2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Graph q-line, Rectifying and Stripping section</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">,</span> <span class="n">x_m2</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">,</span> <span class="n">x_m2</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">,</span> <span class="n">y_top</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">,</span> <span class="n">y_top</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">],</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">f</span><span class="s1">&#39;Stages: </span><span class="si">{stages}</span><span class="s1">, Feed: </span><span class="si">{feed_stage}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Graphical aid&#39;</span><span class="p">,</span> <span class="s1">&#39;eq-line&#39;</span><span class="p">,</span> <span class="s1">&#39;q-line&#39;</span><span class="p">,</span> <span class="s1">&#39;ROL&#39;</span><span class="p">,</span> <span class="s1">&#39;SOL&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;McCabe Thiele Diagram (Rmin = </span><span class="si">{Rmin:.2f}</span><span class="s1">, R = </span><span class="si">{R:.2f}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plt</span></div></div>


<span class="c1"># class Stripper(Dist):</span>
<span class="c1">#     line = &#39;Stripper&#39;</span>
<span class="c1">#     __doc__ = column_doc.replace(&#39;{Column Type}&#39;, &#39;Stripper&#39;)</span>
<span class="c1">#     _N_heat_utilities = 0</span>
<span class="c1">#     _graphics = Dist._graphics</span>
<span class="c1">#     _units ={&#39;Minimum boil up&#39;: &#39;Ratio&#39;,</span>
<span class="c1">#              &#39;Boil up&#39;: &#39;Ratio&#39;,</span>
<span class="c1">#              &#39;Height&#39;: &#39;ft&#39;,</span>
<span class="c1">#              &#39;Diameter&#39;: &#39;ft&#39;,</span>
<span class="c1">#              &#39;Wall thickness&#39;: &#39;in&#39;,</span>
<span class="c1">#              &#39;Weight&#39;: &#39;lb&#39;}</span>
    
<span class="c1">#     def _init(self):</span>
<span class="c1">#         self._boiler = HXutility(None,</span>
<span class="c1">#                                  ins=Stream(None),</span>
<span class="c1">#                                  outs=MixedStream(None))</span>
<span class="c1">#         self._heat_utilities = self._boiler._heat_utilities</span>
<span class="c1">#         self._boil_up = Stream(None)</span>
<span class="c1">#         self._McCabeThiele_args = np.array([0, 0, 0, 0])</span>
    
<span class="c1">#     def plot_stages(self):</span>
<span class="c1">#         # Plot stages, graphical aid and equilibrium curve</span>
<span class="c1">#         self._plot_stages()</span>
        
<span class="c1">#         # Cached Data</span>
<span class="c1">#         vap, liq = self.outs</span>
<span class="c1">#         Design = self._Design</span>
<span class="c1">#         cached = self._cached</span>
<span class="c1">#         x_stages = cached.get(&#39;x_stages&#39;)</span>
<span class="c1">#         if not x_stages:</span>
<span class="c1">#             self._design()</span>
<span class="c1">#             x_stages = cached.get(&#39;x_stages&#39;)</span>
<span class="c1">#         y_top = self.y_top</span>
<span class="c1">#         x_bot = self.x_bot</span>
<span class="c1">#         stages = Design[&#39;Theoretical stages&#39;]</span>
<span class="c1">#         Bmin = Design[&#39;Minimum boil up&#39;]</span>
<span class="c1">#         B = Design[&#39;Boil up&#39;]</span>
        
<span class="c1">#         # Graph Stripping section</span>
<span class="c1">#         ss = self._ss</span>
<span class="c1">#         plt.plot([x_bot, ss(y_top)], [x_bot, y_top])</span>
<span class="c1">#         plt.legend([f&#39;Stages: {stages}&#39;, &#39;Graphical aid&#39;, &#39;eq-line&#39;, &#39;SOL&#39;], fontsize=12)</span>
            
<span class="c1">#         # Title</span>
<span class="c1">#         plt.title(f&#39;McCabe Thiele Diagram (Bmin = {Bmin:.2f}, B = {B:.2f})&#39;)</span>
<span class="c1">#         plt.show()</span>
<span class="c1">#         return plt</span>
    
<span class="c1">#     def _calc_Nstages(self):</span>
<span class="c1">#         &quot;&quot;&quot;Return the actunal number of stages&quot;&quot;&quot;</span>
<span class="c1">#         vap, liq = self.outs</span>
<span class="c1">#         cached = self._cached</span>
<span class="c1">#         Design = self._Design</span>
<span class="c1">#         x_stages = cached[&#39;x_stages&#39;]</span>
<span class="c1">#         y_stages = cached[&#39;y_stages&#39;]</span>
<span class="c1">#         LHK_index = cached[&#39;LHK_index&#39;]</span>
<span class="c1">#         B = Design[&#39;Boil up&#39;]</span>
<span class="c1">#         N_stages = Design[&#39;Theoretical stages&#39;]</span>
        
<span class="c1">#         stage_efficiency =self.stage_efficiency</span>
<span class="c1">#         if stage_efficiency:</span>
<span class="c1">#             return N_stages/stage_efficiency</span>
<span class="c1">#         else:</span>
<span class="c1">#             # Calculate Murphree Efficiency for stripping section</span>
<span class="c1">#             mu = 1000 * liq.mu # mPa*s</span>
<span class="c1">#             cached[&#39;V_mol&#39;] = V_mol = B*sum(liq.mol[LHK_index])</span>
<span class="c1">#             cached[&#39;L_mol&#39;] = L_mol = liq.molnet + V_mol</span>
<span class="c1">#             K_light = y_stages[0]/x_stages[0] </span>
<span class="c1">#             K_heavy = (1-y_stages[0])/(1-x_stages[0] )</span>
<span class="c1">#             alpha = K_light/K_heavy</span>
<span class="c1">#             cached[&#39;Stripping Section Efficiency&#39;] = E_stripper = self._calc_MurphreeEfficiency(mu, alpha, L_mol, V_mol)</span>
<span class="c1">#         return np.ceil(N_stages/E_stripper)</span>
    
<span class="c1">#     def _McCabeThiele(self):</span>
<span class="c1">#         distillate, bottoms = self.outs</span>
<span class="c1">#         Design = self._Design</span>
<span class="c1">#         cached = self._cached</span>
        
<span class="c1">#         # Some important info</span>
<span class="c1">#         species = self._LHK_species</span>
<span class="c1">#         P = self.P</span>
<span class="c1">#         k = self.k</span>
<span class="c1">#         y_top = self.y_top</span>
<span class="c1">#         x_bot = self.x_bot</span>
        
<span class="c1">#         old_args = self._McCabeThiele_args</span>
<span class="c1">#         args = np.array([y_top, x_bot, k, P])</span>
<span class="c1">#         if (abs(old_args - args) &lt; np.array([0.00001, 0.00001, 0.01, 50], float)).all(): return</span>
<span class="c1">#         self._McCabeThiele_args = args</span>
        
<span class="c1">#         # Get B_min (Boil up ratio)</span>
<span class="c1">#         y_Rmin = y_top</span>
<span class="c1">#         T_guess, x = distillate._dew_T(species, [y_Rmin, 1-y_Rmin], P)</span>
<span class="c1">#         x_Rmin = x[0]</span>
<span class="c1">#         m = (y_Rmin-x_bot)/(x_Rmin-x_bot)</span>
<span class="c1">#         Bmin = 1/(m-1)</span>
<span class="c1">#         B = 0.1*k if Bmin &lt;= 0 else Bmin*k</span>

<span class="c1">#         # Stripping section: Inntersects liquid composition with slope given by (B+1)/B</span>
<span class="c1">#         m = (B+1)/B</span>
<span class="c1">#         b = x_bot-m*x_bot</span>
<span class="c1">#         def ss(y): return (y - b)/m</span>
<span class="c1">#         self._ss = ss</span>
                
<span class="c1">#         # Data for staircase</span>
<span class="c1">#         cached[&#39;x_stages&#39;] = x_stages = [x_bot]</span>
<span class="c1">#         cached[&#39;y_stages&#39;] = y_stages = [x_bot]</span>
<span class="c1">#         cached[&#39;T_stages&#39;] = T_stages = []</span>
<span class="c1">#         self._equilibrium_staircase(ss, x_stages, y_stages, T_stages, ss(y_top))</span>
<span class="c1">#         stages = len(x_stages)</span>
        
<span class="c1">#         # Results</span>
<span class="c1">#         Design[&#39;Theoretical stages&#39;] = stages</span>
<span class="c1">#         Design[&#39;Minimum boil up&#39;] = Bmin</span>
<span class="c1">#         Design[&#39;Boil up&#39;] = B</span>
    
<span class="c1">#     def _design(self):</span>
<span class="c1">#         distillate, bottoms = self.outs</span>
<span class="c1">#         Design = self._Design</span>
<span class="c1">#         cached = self._cached</span>
        
<span class="c1">#         ### Get number of stages and height ###</span>
        
<span class="c1">#         self._McCabeThiele()</span>
<span class="c1">#         TS = self._TS</span>
<span class="c1">#         Design[&#39;Actual stages&#39;] = Nstages = self._calc_Nstages()</span>
<span class="c1">#         Design[&#39;Height&#39;] = H = self._calc_Height(TS, Nstages-1)</span>
        
<span class="c1">#         ### Get diameter of stripping section based on feed plate ###</span>
        
<span class="c1">#         V_mol = cached[&#39;V_mol&#39;]</span>
<span class="c1">#         L_mol = cached[&#39;L_mol&#39;]</span>
<span class="c1">#         rho_L = bottoms.rho</span>
<span class="c1">#         boil_up_flow = cached[&#39;boilup_molfrac&#39;] * V_mol</span>
<span class="c1">#         boil_up = cached[&#39;boil_up&#39;]</span>
<span class="c1">#         boil_up.T = bottoms.T; boil_up.P = bottoms.P</span>
<span class="c1">#         lookup = bottoms._species._compounds.index</span>
<span class="c1">#         index_ = [lookup(i) for i in cached[&#39;vle_bot&#39;]]</span>
<span class="c1">#         boil_up.mol[index_] = boil_up_flow</span>
<span class="c1">#         V = boil_up.massnet</span>
<span class="c1">#         V_vol = 0.0002778 * boil_up.volnet # m^3/s</span>
<span class="c1">#         rho_V = boil_up.rho</span>
<span class="c1">#         L = sum(bottoms.MW*bottoms.molfrac*L_mol) # To get liquid going down</span>
<span class="c1">#         F_LV = self._calc_FlowParameter(L, V, rho_V, rho_L)</span>
<span class="c1">#         C_sbf = self._calc_MaxCapacityParameter(TS, F_LV)</span>
<span class="c1">#         sigma = 1000 * bottoms.sigma # dyn/cm</span>
<span class="c1">#         U_f = self._calc_MaxVaporVelocity(C_sbf, sigma, rho_L, rho_V, self._F_F, self._A_ha)</span>
<span class="c1">#         A_dn = self._A_dn or self._calc_DowncomerAreaRatio(F_LV)</span>
<span class="c1">#         Design[&#39;Diameter&#39;] = Di = self._calc_Diameter(V_vol, U_f, self._f, A_dn)</span>
<span class="c1">#         Po = self.P/101325*14.7</span>
<span class="c1">#         Design[&#39;Wall thickness&#39;] = tv = self._calc_WallThickness(Po, Di, H)</span>
<span class="c1">#         rho_M = rho_Mdict[self._F_Mstr]</span>
<span class="c1">#         Design[&#39;Weight&#39;] = self._calc_Weight(Di, H, tv, rho_M)</span>
    
<span class="c1">#     def _cost_components(self):</span>
<span class="c1">#         # Cost boiler</span>
<span class="c1">#         self._calc_boiler()</span>
<span class="c1">#         self._Cost[&#39;Boiler&#39;] = self._boiler._Cost[&#39;Heat exchanger&#39;]</span>

    
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Yoel Cortes-Pena and Jeremy Guest

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>